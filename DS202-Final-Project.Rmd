---
title: "Evaluation of basketball statistics"
author: "Blake Nelson, Nick Olech"
date: "2024-03-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Description of Data Set

For our project we are combining two different data sets.  The first data frame has information for each player such as personal information and draft information like what position, draft year, and draft team.  The second dataframe gives year by year information for each player in the first data frame. This information includes salary, season, and team.

### Loading packages and data frames
```{r, message=FALSE, error=FALSE, warning=FALSE}
library(ggplot2)
library(tidyverse)
library(dplyr)
library(scales)
```

```{r}
#Draft information Data Frame
df1 <-
  read.csv(
    "https://query.data.world/s/7fyub35dc6n4crgjosveptbc7uxeo3?dws=00000",
    header = TRUE,
    stringsAsFactors = FALSE
  )

#Salary information Data Frame
df2 <-
  read.csv(
    "https://query.data.world/s/6xhwdm7emdeglx4botceotj6udfevo?dws=00000",
    header = TRUE,
    stringsAsFactors = FALSE
  )
```

# First Data Cleaning Steps

```{r}
#Merge df1 (draft info) and df2 (salary statistics)
nba_stats <-
  merge(df2,
        df1,
        by.x = "player_id",
        by.y = "X_id",
        all.x = TRUE)
```

```{r}
#Drop player that were drafted before 1980 
nba_stats <- nba_stats %>%
  filter(draft_year >= 1980)

#Replaces empty values with NA
nba_stats <- nba_stats %>% 
  mutate(across(where(is.character), ~na_if(.x, "")))
```
Note: Players that were drafted before 1980 are not accounted for in order to be more indicative of the modern era.

# Marginal Summaries
```{r}
head(nba_stats)
```

```{r}
summary(nba_stats)
```

```{r}
dim(nba_stats)
```
First I want to look at the overall salaries that are listed in this dataset to get a sort of gague of what the numbers should look like.
```{r}
#Make so there are no repeat id's and get salary statistics
nba_salary_summary <- nba_stats %>%
  group_by(player_id) %>%
  summarize(
    Total_Salary = sum(salary, na.rm = TRUE),
    Average_Salary = mean(salary, na.rm = TRUE),
    .groups = 'drop'
  )

#Graph to see how much the average player made over their career
ggplot(data = nba_salary_summary, aes(x = Total_Salary)) +
  geom_histogram(binwidth = 1000000) +
  scale_x_continuous(labels = label_number()) +
  labs(title = "Histogram of NBA Total Salaries",
       x = "Total Salary",
       y = "Frequency") +
  theme_minimal()

#Graph to see how much the average player makes over the course of one singular season
ggplot(data = nba_salary_summary, aes(x = Average_Salary)) +
  geom_histogram(binwidth = 100000) +
  scale_x_continuous(labels = label_number()) +
  labs(title = "Histogram of NBA Average Salaries",
       x = "Average Salary",
       y = "Frequency") +
  theme_minimal()

```
I am a little concerned that this dataset is not representative of how much players have made but since the data is pre 2019 this makes sense.

NBA salaries are increasingly inflated, especially in the last half decade, therefore it makes sense these numbers are lower than we are nowadays accustomed to. 

```{r}
library(dplyr)

# Checking for average salaries greater than $15 million
high_salary_players <- nba_salary_summary %>%
  filter(Average_Salary > 15000000)

# Viewing the results
print(high_salary_players)
count(high_salary_players)
```
Now lets look to answer "Does where you are born influence your likely hood of NBA success?"
```{r}
#Separate the birthplace column into two separate rows and look at what city/state they are from
nba_birthplace_summary <- nba_stats %>%
  distinct(player_id, .keep_all = TRUE) %>%
  separate(birthPlace, into = c("City", "State_Country"), sep = ", ", extra = "merge") %>%
  group_by(player_id, State_Country) %>%
  ungroup() %>%
  count(State_Country, sort = TRUE)

#Plot which states/countries have the most players (top 10)
N <- 10

#Creat varaible that shows where most players are from (state/country)
top_nba_locations <- nba_birthplace_summary %>%
  top_n(N, n) %>%
  arrange(desc(n))

#Graph Findings
ggplot(top_nba_locations, aes(x = reorder(State_Country, n), y = n)) +
  geom_bar(stat = "identity") +
  labs(x = "State/Country", y = "Number of Players", 
       title = "Number of NBA Players by State/Country") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

#Get a table that shows output
print(nba_birthplace_summary)







```
Population for each state/country
-California 39.03 M
-New York 19.68 M
-Illinois 12.58 M
-Texas 30.03 M
-Georgia 10.91 M

```{r}
#Find players per state (One NBA player every x people)
Players_CA <- 39030000 / 184 
Players_NY <- 19680000 / 117
Players_IL <- 12580000 / 92
Players_TX <- 30030000 / 68
Players_GA <- 10910000 / 65

print(Players_CA)
print(Players_NY)
print(Players_IL)
print(Players_TX)
print(Players_GA)

```



```{r}
#Same thing now, except group by city
nba_birthplace_city_summary <- nba_stats %>%
  distinct(player_id, .keep_all = TRUE) %>%
  separate(birthPlace, into = c("City", "State_Country"), sep = ", ", extra = "merge") %>%
  group_by(player_id, City) %>%
  ungroup() %>%
  count(City, sort = TRUE)

#Plot which cities have the most players (top 10)
top_nba_locations_cities <- nba_birthplace_city_summary %>%
  top_n(N, n) %>%
  arrange(desc(n))

#Plot findings
ggplot(top_nba_locations_cities, aes(x = reorder(City, n), y = n)) +
  geom_bar(stat = "identity") +
  labs(x = "City", y = "Number of Players", 
       title = "Number of NBA Players by City") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

#Print table
print(nba_birthplace_city_summary)

```
Populations for each city
-Los Angeles: 3.822 M
-Chicago 2.665 M
-Philadelphia 1.567 M
-Washington 671803
-Detroit 620376
```{r}
#Find players per state (One NBA player every x people)
Players_LA <- 3822000 / 54 
Players_CHI <- 2665000 / 49
Players_PHIL <- 1567000 / 34
Players_WSH <- 671803 / 31
Players_DET <- 620376 / 28

print(Players_LA)
print(Players_CHI)
print(Players_PHIL)
print(Players_WSH)
print(Players_DET)
```




# Questions to possibly research

What is the ideal height/weight (build) of an NBA Player?
- Could look at how salary relates to certain measurements a player has.

Does where you are born influence your likely hood of NBA success?
- Could look at salary or sheer number of NBA players from certain regions and then divide by each respective population.

What position in basketball seems to contribute to winning the most?
- Could look to analyze win shares and other statistics relating to positions.

Ideas
Look to model the perfect NBA "prospect"
Utilize comparative analysis in order to predict future player success.
















