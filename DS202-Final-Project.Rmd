---
title: "Evaluation of basketball statistics"
author: "Blake Nelson, Nick Olech"
date: "2024-03-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Description of Data Set

For our project we are combining two different data sets.  The first data frame has information for each player such as personal information and draft information like what position, draft year, and draft team.  The second dataframe gives year by year information for each player in the first data frame. This information includes salary, season, and team.

### Loading packages and data frames
```{r, message=FALSE, error=FALSE, warning=FALSE}
library(ggplot2)
library(tidyverse)
library(dplyr)
library(scales)
```

```{r}
#Draft information Data Frame
df1 <-
  read.csv(
    "https://query.data.world/s/7fyub35dc6n4crgjosveptbc7uxeo3?dws=00000",
    header = TRUE,
    stringsAsFactors = FALSE
  )

#Salary information Data Frame
df2 <-
  read.csv(
    "https://query.data.world/s/6xhwdm7emdeglx4botceotj6udfevo?dws=00000",
    header = TRUE,
    stringsAsFactors = FALSE
  )
```

# First Data Cleaning Steps

```{r}
#Merge df1 (draft info) and df2 (salary statistics)
nba_stats <-
  merge(df2,
        df1,
        by.x = "player_id",
        by.y = "X_id",
        all.x = TRUE)
```

```{r}
#Drop player that were drafted before 1980 
nba_stats <- nba_stats %>%
  filter(draft_year >= 1980)

#Replaces empty values with NA
nba_stats <- nba_stats %>% 
  mutate(across(where(is.character), ~na_if(.x, "")))
```
Note: Players that were drafted before 1980 are not accounted for in order to be more indicative of the modern era.

# Marginal Summaries
```{r}
head(nba_stats)
```

```{r}
summary(nba_stats)
```

```{r}
dim(nba_stats)
```
First I want to look at the overall salaries that are listed in this dataset to get a sort of gague of what the numbers should look like.
```{r}
#Make so there are no repeat id's and get salary statistics
nba_salary_summary <- nba_stats %>%
  group_by(player_id) %>%
  summarize(
    Total_Salary = sum(salary, na.rm = TRUE),
    Average_Salary = mean(salary, na.rm = TRUE),
    .groups = 'drop'
  )

#Graph to see how much the average player made over their career
ggplot(data = nba_salary_summary, aes(x = Total_Salary)) +
  geom_histogram(binwidth = 1000000) +
  scale_x_continuous(labels = label_number()) +
  labs(title = "Histogram of NBA Total Salaries",
       x = "Total Salary",
       y = "Frequency") +
  theme_minimal()

#Graph to see how much the average player makes over the course of one singular season
ggplot(data = nba_salary_summary, aes(x = Average_Salary)) +
  geom_histogram(binwidth = 100000) +
  scale_x_continuous(labels = label_number()) +
  labs(title = "Histogram of NBA Average Salaries",
       x = "Average Salary",
       y = "Frequency") +
  theme_minimal()

```
I am a little concerned that this dataset is not representative of how much players have made but since the data is pre 2019 this makes sense.

NBA salaries are increasingly inflated, especially in the last half decade, therefore it makes sense these numbers are lower than we are nowadays accustomed to. 

```{r}
library(dplyr)

# Checking for average salaries greater than $15 million
high_salary_players <- nba_salary_summary %>%
  filter(Average_Salary > 15000000)

# Viewing the results
print(high_salary_players)
count(high_salary_players)
```
Now lets look to answer "Does where you are born influence your likely hood of NBA success?"
```{r}
#Separate the birthplace column into two separate rows and look at what city/state they are from
nba_birthplace_summary <- nba_stats %>%
  distinct(player_id, .keep_all = TRUE) %>%
  separate(birthPlace, into = c("City", "State_Country"), sep = ", ", extra = "merge") %>%
  group_by(player_id, State_Country) %>%
  ungroup() %>%
  count(State_Country, sort = TRUE)

#Same thing now, except group by city
nba_birthplacecity_summary <- nba_stats %>%
  distinct(player_id, .keep_all = TRUE) %>%
  separate(birthPlace, into = c("City", "State_Country"), sep = ", ", extra = "merge") %>%
  group_by(player_id, City) %>%
  ungroup() %>%
  count(City, sort = TRUE)








```


# Questions to possibly research

What is the ideal height/weight (build) of an NBA Player?
- Could look at how salary relates to certain measurements a player has.
```{r}
str(nba_stats)
# Create a copy of nba_stats
ns_w_cd <- nba_stats

# Add career_duration column
ns_w_cd$career_duration <- ifelse(ns_w_cd$career_G > 4*82, "Over 4 Years", "Under 4 Years")

# Filter to include only unique player IDs
unique_players <- ns_w_cd %>% 
  distinct(player_id, .keep_all = TRUE)

# Plotting the correlation between weight and career duration
weight_duration_plot <- ggplot(unique_players, aes(x = weight, y = career_G, color = career_duration)) +
  geom_point() +
  geom_smooth(aes(group = career_duration), method = "lm", se = FALSE, color = "black") +  # Add black linear regression lines
  labs(title = "Correlation between Weight and Career Duration (Unique Players)", x = "Weight", y = "Career Duration") +
  theme_minimal()

# Display the plot
print(weight_duration_plot)

# Plotting the correlation between height and career duration
height_duration_plot <- ggplot(unique_players, aes(x = height, y = career_G, color = career_duration)) +
  geom_point() +
  geom_smooth(aes(group = career_duration), method = "lm", se = FALSE, color = "black") +  # Add black linear regression lines
  labs(title = "Correlation between Height and Career Duration (Unique Players)", x = "Height", y = "Career Duration") +
  theme_minimal()

# Display the plot
print(height_duration_plot)
```

```{r}
# Convert height from feet-inches format to inches
height_inches <- sapply(strsplit(unique_players$height, "-"), function(x) as.numeric(x[1]) * 12 + as.numeric(x[2]))

# Calculate average height (in inches) and weight (in pounds)
average_height_inches <- mean(height_inches, na.rm = TRUE)
average_weight <- mean(as.numeric(gsub("lb", "", unique_players$weight)), na.rm = TRUE)

# Convert average height from inches to feet-inches format
average_height_feet <- floor(average_height_inches / 12)
average_height_remainder <- round(average_height_inches %% 12)
average_height <- paste(average_height_feet, "ft", average_height_remainder, "in")

# Print the results
cat("Average Height:", average_height, "\n")
cat("Average Weight:", round(average_weight, 2), "lb\n")

```

Does where you are born influence your likely hood of NBA success?
- Could look at salary or sheer number of NBA players from certain regions and then divide by each respective population.

What position in basketball seems to contribute to winning the most?

```{r}


```
- Could look to analyze win shares and other statistics relating to positions.

Ideas
Look to model the perfect NBA "prospect"
Utilize comparative analysis in order to predict future player success.
















