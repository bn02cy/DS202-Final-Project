---
title: "Evaluation of basketball statistics"
author: "Blake Nelson, Nick Olech"
date: "2024-03-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Description of Data Set

For our project we are combining two different data sets.  The first data frame has information for each player such as personal information and draft information like what position, draft year, and draft team.  The second dataframe gives year by year information for each player in the first data frame. This information includes salary, season, and team.

### Loading packages and data frames
```{r, message=FALSE, error=FALSE, warning=FALSE}
# Load required packages
library(ggplot2)
library(tidyverse)
library(dplyr)
library(scales)
```

```{r}
# Draft information Data Frame
df1 <-
  read.csv(
    "https://query.data.world/s/7fyub35dc6n4crgjosveptbc7uxeo3?dws=00000",
    header = TRUE,
    stringsAsFactors = FALSE
  )

# Salary information Data Frame
df2 <-
  read.csv(
    "https://query.data.world/s/6xhwdm7emdeglx4botceotj6udfevo?dws=00000",
    header = TRUE,
    stringsAsFactors = FALSE
  )
```

# First Data Cleaning Steps

```{r, warning=FALSE}
# Merge df1 (draft info) and df2 (salary statistics)
nba_stats <-
  merge(df2,
        df1,
        by.x = "player_id",
        by.y = "X_id",
        all.x = TRUE)

# Replaces empty values with NA
nba_stats <- nba_stats %>%
  mutate(across(where(is.character), ~ na_if(.x, "")))

# Convert data types
nba_stats <- nba_stats %>%
  mutate(
    height = as.numeric(sub("([0-9]+)-([0-9]+)", "\\1", height)) * 12 +
      as.numeric(sub("([0-9]+)-([0-9]+)", "\\2", height)),
    career_FG. = as.numeric(career_FG.),
    career_FT. = as.numeric(career_FT.),
    career_PER = as.numeric(career_PER),
    career_PTS = as.numeric(career_PTS),
    career_TRB = as.numeric(career_TRB),
    career_WS = as.numeric(career_WS),
    draft_pick = as.numeric(gsub("[^0-9]", "", draft_pick)),
    # Extract numeric values from draft pick
    weight = as.numeric(gsub("[^0-9.]", "", weight))           # Extract numeric values from weight
  )

# Drop missing values
nba_stats <- na.omit(nba_stats)

# Drop players that were drafted before 1980
nba_stats <- nba_stats %>%
  filter(draft_year >= 1980)
```
Note: Players that were drafted before 1980 are not accounted for in order to be more indicative of the modern era.

# Marginal Summaries
```{r}
str(nba_stats)
```

```{r}
head(nba_stats)
```

```{r}
summary(nba_stats)
```

```{r}
dim(nba_stats)
```

# Questions to possibly research

## Does where you are born influence your likely hood of NBA success?
### - Could look at salary or sheer number of NBA players from certain regions and then divide by each respective population.

First I want to look at the overall salaries that are listed in this dataset to get a sort of gague of what the numbers should look like.
```{r}
#Make so there are no repeat id's and get salary statistics
nba_salary_summary <- nba_stats %>%
  group_by(player_id) %>%
  summarize(
    Total_Salary = sum(salary, na.rm = TRUE),
    Average_Salary = mean(salary, na.rm = TRUE),
    .groups = 'drop'
  )

#Graph to see how much the average player made over their career
ggplot(data = nba_salary_summary, aes(x = Total_Salary)) +
  geom_histogram(binwidth = 1000000) +
  scale_x_continuous(labels = label_number()) +
  labs(title = "Histogram of NBA Total Salaries",
       x = "Total Salary",
       y = "Frequency") +
  theme_minimal()

#Graph to see how much the average player makes over the course of one singular season
ggplot(data = nba_salary_summary, aes(x = Average_Salary)) +
  geom_histogram(binwidth = 100000) +
  scale_x_continuous(labels = label_number()) +
  labs(title = "Histogram of NBA Average Salaries",
       x = "Average Salary",
       y = "Frequency") +
  theme_minimal()

```
I am a little concerned that this dataset is not representative of how much players have made but since the data is pre 2019 this makes sense.

NBA salaries are increasingly inflated, especially in the last half decade, therefore it makes sense these numbers are lower than we are nowadays accustomed to. 

```{r}
library(dplyr)

# Checking for average salaries greater than $15 million
high_salary_players <- nba_salary_summary %>%
  filter(Average_Salary > 15000000)

# Viewing the results
print(high_salary_players)
count(high_salary_players)
```

Now lets look to answer "Does where you are born influence your likely hood of NBA success?"

```{r}
#Separate the birthplace column into two separate rows and look at what city/state they are from
nba_birthplace_summary <- nba_stats %>%
  distinct(player_id, .keep_all = TRUE) %>%
  separate(birthPlace, into = c("City", "State_Country"), sep = ", ", extra = "merge") %>%
  group_by(player_id, State_Country) %>%
  ungroup() %>%
  count(State_Country, sort = TRUE)

#Same thing now, except group by city
nba_birthplacecity_summary <- nba_stats %>%
  distinct(player_id, .keep_all = TRUE) %>%
  separate(birthPlace, into = c("City", "State_Country"), sep = ", ", extra = "merge") %>%
  group_by(player_id, City) %>%
  ungroup() %>%
  count(City, sort = TRUE)
```

## What is the ideal height/weight (build) of an NBA Player?
- Could look at how salary relates to certain measurements a player has.
```{r}
# Create a copy of nba_stats
ns_w_cd <- nba_stats

# Add career_duration column
ns_w_cd$career_duration <- ifelse(ns_w_cd$career_G > 4*82, "Over 4 Years", "Under 4 Years")

# Filter to include only unique player IDs
unique_players <- ns_w_cd %>% 
  distinct(player_id, .keep_all = TRUE)

# Plotting the correlation between weight and career duration
weight_duration_plot <- ggplot(unique_players, aes(x = weight, y = career_G, color = career_duration)) +
  geom_point() +
  geom_smooth(aes(group = career_duration), method = "lm", se = FALSE, color = "black") +  # Add black linear regression lines
  labs(title = "Correlation between Weight and Career Duration (Unique Players)", x = "Weight", y = "Career Duration") +
  theme_minimal()

# Display the plot
print(weight_duration_plot)

# Plotting the correlation between height and career duration
height_duration_plot <- ggplot(unique_players, aes(x = height, y = career_G, color = career_duration)) +
  geom_point() +
  geom_smooth(aes(group = career_duration), method = "lm", se = FALSE, color = "black") +  # Add black linear regression lines
  labs(title = "Correlation between Height and Career Duration (Unique Players)", x = "Height", y = "Career Duration") +
  theme_minimal()

# Display the plot
print(height_duration_plot)
```

```{r}
# Boxplot of height for high-salary and low-salary players
ggplot(nba_stats, aes(x = factor(salary > median(salary)), y = height)) +
  geom_boxplot() +
  labs(title = "Height Distribution of High-Salary and Low-Salary Players",
       x = "Salary Level",
       y = "Height")

# Boxplot of weight for high-salary and low-salary players
ggplot(nba_stats, aes(x = factor(salary > median(salary)), y = weight)) +
  geom_boxplot() +
  labs(title = "Weight Distribution of High-Salary and Low-Salary Players",
       x = "Salary Level",
       y = "Weight")

```

## What are the key performance indicators for success in basketball?
```{r}
# Create a scatter plot for Position vs. Salary
ggplot(nba_stats, aes(x = position, y = salary)) +
  geom_boxplot() +
  labs(title = "Salary Distribution by Position",
       x = "Position",
       y = "Salary") +
  theme_minimal() +
  coord_flip()
```
```{r}
#Player Efficiency Rating (PER) vs. Salary
ggplot(nba_stats, aes(x = career_PER, y = salary)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  labs(title = "Player Efficiency Rating (PER) vs. Salary",
       x = "Career PER",
       y = "Salary") +
  theme_minimal()
```

```{r}
#Win Shares vs. Salary
ggplot(nba_stats, aes(x = career_WS, y = salary)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "Win Shares vs. Salary",
       x = "Career Win Shares",
       y = "Salary") +
  theme_minimal()
```
```{r}
#Draft Pick vs. Salary
ggplot(nba_stats, aes(x = draft_pick, y = salary)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE, color = "green") +
  labs(title = "Draft Pick vs. Salary",
       x = "Draft Pick",
       y = "Salary") +
  theme_minimal()
```
## What position in basketball seems to contribute to winning the most?
- Could look to analyze win shares and other statistics relating to positions.

```{r}
# Aggregate data by position and calculate mean career win shares
position_summary <- nba_stats %>%
  group_by(position) %>%
  summarise(mean_career_WS = mean(career_WS, na.rm = TRUE))

# Create a bar plot
ggplot(position_summary, aes(x = position, y = mean_career_WS)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(
    title = "Average Career Win Shares by Position",
    x = "Position",
    y = "Mean Career Win Shares"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Ideas
Look to model the perfect NBA "prospect"
Utilize comparative analysis in order to predict future player success.














